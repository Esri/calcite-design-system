<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <script type="module">
      import "/stub.js";
    </script>
  </head>
  <body>
    <button onclick="remove('calcite-icon');">Remove icon</button>
    <calcite-icon></calcite-icon>
    <script type="module">
      class ProxyComponent extends HTMLElement {
        constructor() {
          super();
          const renderRoot = this.attachShadow({
            mode: "open",
          });
          const style = new CSSStyleSheet();
          style.replaceSync(`:host{display:inline-block}`);
          renderRoot.adoptedStyleSheets = [style];
        }
      }
      customElements.define("calcite-icon", ProxyComponent);
    </script>
    <script>
      const registry = new FinalizationRegistry((heldValue) => {
        console.log(`garbage collected "${heldValue}"`);
      });
      function remove(tagName) {
        let el = document.querySelector(tagName);
        registry.register(el, el.tagName);
        el.remove();
        el.shadowRoot.adoptedStyleSheets = [];
      }
    </script>
  </body>
</html>
